<!-- === Halaman Konfigurasi Seleksi (Tabs) === -->
<div
  id="configComponent"
  x-show="page === 'config'"
  x-data="{
    tab: 'periode',
    completed: { periode: false, kontingen: false, kriteria: false },
    activities: [{
      nama:'',
      mulai:'',
      selesai:'',
      skala:'',
      jenis:'',
      kwartir:'',
      waktu:'',
      tempat:'',
      putra:0,
      putri:0,
      criteria: getDefaultCriteria()
    }],
    contingents: [{ nama: '', umpiPutra: 0, umpiPutri: 0 }],
    showModal: false,
    selectedIndex: null,
    errorMessage: '',
    aIndex: null,
    showDeleteModal: false,
    deleteIndex: null,

    initAutocomplete(el, index) {
         if (!window.google || !window.google.maps) return;
         const autocomplete = new google.maps.places.Autocomplete(el, {
           types: ['geocode', 'establishment'],
           componentRestrictions: { country: 'id' },
         });
         autocomplete.addListener('place_changed', () => {
           const place = autocomplete.getPlace();
           this.activities[index].tempat = place.formatted_address || place.name;
         });
       },

    toggleAspect(event, index) {
      let crit = this.activities[this.aIndex].criteria[index];
      if (event.target.checked) {
        crit.jenis.push(event.target.value);
      } else {
        crit.jenis = crit.jenis.filter(a => a !== event.target.value);
      }
    },

    savePeriode() {
      const invalidAct = this.activities.find(a => !a.nama || !a.mulai || !a.selesai);
      if (invalidAct) {
        this.errorMessage = 'Nama kegiatan dan periode harus diisi';
        return;
      }
      this.completed.periode = true;
      this.tab = 'kontingen';
      this.errorMessage = '';
    },

    saveCriteria() {
      if (this.selectedIndex === null) return;
      let act = this.activities[this.aIndex];
      let crit = act.criteria[this.selectedIndex];

      if (!crit.nama || crit.skala === null || crit.skala === undefined) {
        this.errorMessage = 'Nama kriteria dan skala wajib diisi!';
        return;
      }
      if (isNaN(crit.skala) || crit.skala < 0 || crit.skala > 10) {
        this.errorMessage = 'Skala harus angka antara 0 - 10!';
        return;
      }

      act.criteria[this.selectedIndex] = {
        ...crit,
        skala: parseInt(crit.skala),
        jenis: crit.jenis || []
      };
      this.showModal = false;
    }
  }"
  x-transition:enter="transition ease-out duration-500"
  x-transition:enter-start="opacity-0 translate-y-5"
  x-transition:enter-end="opacity-100 translate-y-0"
  x-transition:leave="transition ease-in duration-300"
  x-transition:leave-start="opacity-100 translate-y-0"
  x-transition:leave-end="opacity-0 translate-y-5"
  class="p-6 rounded-2xl shadow-lg {{ 'bg-gray-800 dark:bg-gray-900' if current_theme == 'dark' else 'bg-white dark:bg-gray-100' }}"
>
  <form id="configForm" onsubmit="return false;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <!-- Tab Navigation -->
    <div>
      <div class="flex border-b mb-6">
        <button
          @click="tab = 'periode'"
          :class="['px-4 py-2 font-medium cursor-pointer', tab==='periode' ? 'border-b-2 {{ 'border-blue-500 text-blue-500' if current_theme == 'dark' else 'border-blue-700 text-blue-700' }} cursor-not-allowed' : '{{ 'text-gray-200' if current_theme == 'dark' else 'text-gray-900' }}']"
        >
          {{ 'Jadwal & Kegiatan' if current_lang == 'id' else 'Period &
          Schedule' }}
          <template x-if="completed.periode">
            <i class="fa-solid fa-square-check text-green-600"></i>
          </template>
        </button>
        <button
          :disabled="!completed.periode"
          @click="tab = 'kontingen'"
          :class="['px-4 py-2 font-medium cursor-pointer', tab==='kontingen' ? 'border-b-2 {{ 'border-blue-500 text-blue-500' if current_theme == 'dark' else 'border-blue-700 text-blue-700' }} cursor-not-allowed' : '{{ 'text-gray-200' if current_theme == 'dark' else 'text-gray-900' }}']"
        >
          {{ 'Komposisi Kontingen' if current_lang == 'id' else 'Qontingent
          Composition' }}
          <template x-if="completed.kontingen">
            <i class="fa-solid fa-square-check text-green-600"></i>
          </template>
        </button>
        <button
          :disabled="!completed.kontingen"
          @click="tab = 'kriteria'"
          :class="['px-4 py-2 font-medium cursor-pointer', tab==='kriteria' ? 'border-b-2 {{ 'border-blue-500 text-blue-500' if current_theme == 'dark' else 'border-blue-700 text-blue-700' }} cursor-not-allowed' : '{{ 'text-gray-200' if current_theme == 'dark' else 'text-gray-900' }}']"
        >
          {{ 'Kriteria Seleksi' if current_lang == 'id' else 'Criteria' }}
          <template x-if="completed.kriteria">
            <i class="fa-solid fa-square-check text-green-600"></i>
          </template>
        </button>
      </div>

      <!-- Tab Content -->
      <div>
        <!-- Periode & Jadwal -->
        <div x-show="tab==='periode'" x-transition>
          <h3 class="font-semibold mb-2">
            {{ 'Periode Seleksi' if current_lang == 'id' else 'Selection Period'
            }}
          </h3>
          <div>
            <template x-for="(act, index) in activities" :key="index">
              <div class="mb-4 p-3 border rounded-lg dark:border-gray-700">
                <!-- Nama Kegiatan -->
                <label class="block text-sm font-medium mb-1 mt-2">
                  {{ 'Nama Kegiatan' if current_lang == 'id' else 'Activity
                  Name' }}
                </label>
                <input
                  type="text"
                  x-model="act.nama"
                  @input="errorMessage = ''; contingents[index].nama = act.nama"
                  placeholder="Contoh: Raimuna Nasional"
                  class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                />
                <small x-show="act.errorNama" class="text-red-500 text-xs">
                  {{ 'Nama kegiatan wajib diisi' if current_lang == 'id' else
                  'Activity name is required' }}
                </small>

                <!-- Skala Kegiatan -->
                <label class="block text-sm font-medium mb-1 mt-2">
                  {{ 'Skala Kegiatan' if current_lang == 'id' else 'Activity
                  Scale' }}
                </label>
                <select
                  x-model="act.skala"
                  class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                >
                  <option value="Ranting">
                    {{ 'Ranting' if current_lang == 'id' else 'Branch' }}
                  </option>
                  <option value="Cabang">
                    {{ 'Cabang' if current_lang == 'id' else 'District' }}
                  </option>
                  <option value="Daerah">
                    {{ 'Daerah' if current_lang == 'id' else 'Region' }}
                  </option>
                  <option value="Nasional">
                    {{ 'Nasional' if current_lang == 'id' else 'National' }}
                  </option>
                  <option value="Internasional">
                    {{ 'Internasional' if current_lang == 'id' else
                    'International' }}
                  </option>
                </select>

                <!-- Jenis Kegiatan -->
                <label class="block text-sm font-medium mb-1 mt-2">
                  {{ 'Jenis Kegiatan' if current_lang == 'id' else 'Activity
                  Type' }}
                </label>
                <select
                  x-model="act.jenis"
                  class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                >
                  <option value="Siaga">
                    {{ 'Siaga' if current_lang == 'id' else 'Cub Scout' }}
                  </option>
                  <option value="Penggalang">
                    {{ 'Penggalang' if current_lang == 'id' else 'Scout' }}
                  </option>
                  <option value="Penegak">
                    {{ 'Penegak' if current_lang == 'id' else 'Rover Scout' }}
                  </option>
                  <option value="Pandega">
                    {{ 'Pandega' if current_lang == 'id' else 'Rover' }}
                  </option>
                  <option value="Penegak dan Pandega">
                    {{ 'Penegak dan Pandega' if current_lang == 'id' else 'Rover
                    Scout and Rover' }}
                  </option>
                </select>

                <!-- Kwartir Penyelenggara -->
                <label class="block text-sm font-medium mb-1 mt-2">
                  {{ 'Kwartir Penyelenggara' if current_lang == 'id' else
                  'Organizing Kwartir' }}
                </label>
                <input
                  type="text"
                  x-model="act.kwartir"
                  placeholder="Contoh: Kwartir Cabang Merauke"
                  class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                />

                <!-- Waktu Pelaksanaan -->
                <label class="block text-sm font-medium mb-1 mt-2">
                  {{ 'Waktu Pelaksanaan' if current_lang == 'id' else 'Execution
                  Time' }}
                </label>
                <div class="flex gap-3">
                  <div class="w-1/2">
                    <small class="text-gray-500"
                      >{{ 'Mulai' if current_lang == 'id' else 'Start' }}</small
                    >
                    <input
                      type="datetime-local"
                      x-model="act.waktuMulai"
                      class="w-full rounded-lg mb-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                    />
                  </div>
                  <div class="w-1/2">
                    <small class="text-gray-500"
                      >{{ 'Selesai' if current_lang == 'id' else 'End' }}</small
                    >
                    <input
                      type="datetime-local"
                      x-model="act.waktuSelesai"
                      class="w-full rounded-lg mb-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                    />
                  </div>
                </div>

                <!-- Tempat Pelaksanaan -->
                <label class="block text-sm font-medium mb-1 mt-2">
                  {{ 'Tempat Pelaksanaan' if current_lang == 'id' else
                  'Execution Date' }}
                </label>
                <input
                  type="text"
                  x-model="activities[index].tempat"
                  placeholder="Cari lokasi..."
                  class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                  @focus="initAutocomplete($el, index)"
                />

                <!-- Periode Pelaksanaan -->
                <label class="block text-sm font-medium mb-1 mt-2">
                  {{ 'Periode Seleksi' if current_lang == 'id' else 'Selection
                  Period' }}
                </label>
                <div class="flex gap-3">
                  <div class="w-1/2">
                    <small class="text-gray-500"
                      >{{ 'Mulai' if current_lang == 'id' else 'Start' }}</small
                    >
                    <input
                      type="datetime-local"
                      x-model="act.mulai"
                      class="w-full rounded-lg mb-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                    />
                  </div>
                  <div class="w-1/2">
                    <small class="text-gray-500"
                      >{{ 'Selesai' if current_lang == 'id' else 'End' }}</small
                    >
                    <input
                      type="datetime-local"
                      x-model="act.selesai"
                      class="w-full rounded-lg mb-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                    />
                  </div>
                </div>

                <!-- Tombol Aksi -->
                <div class="flex gap-2 mt-6">
                  <!-- Tombol Duplikat -->
                  <button
                    @click="activities.push(JSON.parse(JSON.stringify(activities[index])));
                            contingents.push(JSON.parse(JSON.stringify(contingents[index])));"
                    type="button"
                    class="px-2 py-1 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg text-xs cursor-pointer"
                  >
                    <i class="fa-solid fa-copy"></i>
                    {{ 'Duplikat' if current_lang == 'id' else 'Duplicate' }}
                  </button>

                  <!-- Tombol Hapus -->
                  <button
                    @click="activities.splice(index,1)"
                    type="button"
                    class="px-2 py-1 bg-red-500 hover:bg-red-700 text-white rounded-lg text-xs cursor-pointer"
                  >
                    <i class="fa-solid fa-trash"></i>
                    {{ 'Hapus' if current_lang == 'id' else 'Delete' }}
                  </button>
                </div>
              </div>
            </template>

            <!-- Tambah Kegiatan -->
            <button
              @click="activities.push({ nama:'', mulai:'', selesai:'', waktuMulai: '', waktuSelesai: '', skala:'', jenis:'', kwartir:'', waktu:'', tempat:'', putra:0, putri:0, criteria: getDefaultCriteria() }); contingents.push({ nama:'', umpiPutra: 0, umpiPutri: 0 });"
              type="button"
              class="px-3 py-1 bg-green-500 hover:bg-green-700 text-white rounded-lg text-sm cursor-pointer mt-2"
            >
              {{ '+ Tambah Kegiatan' if current_lang == 'id' else '+ Add
              Activity' }}
            </button>

            <!-- Tombol Navigasi -->
            <div class="flex justify-between mt-6">
              <button
                @click="page = 'main'; $store.page.breadcrumbs = current_lang === 'id' ? ['Manajemen Seleksi'] : ['Selection Management']"
                class="px-4 py-2 rounded-lg cursor-pointer {{ 'bg-gray-300 hover:bg-gray-800 dark:bg-gray-700' if current_theme == 'dark' else 'bg-gray-200 hover:bg-gray-500 dark:bg-gray-400' }}"
              >
                <i class="fa-solid fa-backward"></i>
                {{ 'Kembali' if current_lang == 'id' else 'Back' }}
              </button>
              <button
                type="button"
                @click="savePeriode()"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer"
              >
                <i class="fa-solid fa-download"></i>
                {{ 'Simpan & Lanjut' if current_lang == 'id' else 'Save & Next'
                }}
              </button>
            </div>
          </div>
        </div>

        <!-- Komposisi Kotingen -->
        <div x-show="tab==='kontingen'" x-transition>
          <h3 class="font-semibold mb-2">
            {{ 'Komposisi Kontingen' if current_lang == 'id' else 'Contingent
            Composition' }}
          </h3>
          <template x-for="(cont, index) in contingents" :key="index">
            <div class="mb-4 p-3 border rounded-lg dark:border-gray-700">
              <h4
                class="font-medium mb-2 {{ 'text-blue-400' if current_theme == 'dark' else 'text-blue-700' }}"
                x-text="activities[index].nama"
              ></h4>
              <div class="flex gap-3">
                <!-- Umpi Putra -->
                <div class="w-1/2">
                  <label class="block text-sm mb-1">
                    {{ 'Umpi Putra' if current_lang == 'id' else 'Male Umpi' }}
                  </label>
                  <input
                    type="number"
                    min="5"
                    max="12"
                    x-model.number="cont.umpiPutra"
                    placeholder="5–12"
                    class="w-full rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                  />
                </div>

                <!-- Umpi Putri -->
                <div class="w-1/2">
                  <label class="block text-sm mb-1">
                    {{ 'Umpi Putri' if current_lang == 'id' else 'Female Umpi'
                    }}
                  </label>
                  <input
                    type="number"
                    min="5"
                    max="12"
                    x-model.number="cont.umpiPutri"
                    placeholder="5–12"
                    class="w-full rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                  />
                </div>
              </div>
            </div>
          </template>

          <!-- Tombol Navigasi -->
          <div class="flex justify-between mt-6">
            <button
              @click="tab = 'periode'"
              class="px-4 py-2 rounded-lg cursor-pointer {{ 'bg-gray-300 hover:bg-gray-800 dark:bg-gray-700' if current_theme == 'dark' else 'bg-gray-200 hover:bg-gray-500 dark:bg-gray-400' }}"
            >
              <i class="fa-solid fa-backward"></i>
              {{ 'Kembali' if current_lang == 'id' else 'Back' }}
            </button>
            <button
              type="button"
              @click="if (contingents.some(c => c.umpiPutra < 5 || c.umpiPutra > 12 || c.umpiPutri < 5 || c.umpiPutri > 12)) { errorMessage = '{{ 'Komposisi kontingen harus ditentukan' if current_lang == 'id' else 'Participant quota must be set' }}'; return;} completed.kontingen = true; tab = 'kriteria'"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer"
            >
              <i class="fa-solid fa-download"></i>
              {{ 'Simpan & Lanjut' if current_lang == 'id' else 'Save & Next' }}
            </button>
          </div>
        </div>

        <!-- Kriteria Seleksi -->
        <div x-show="tab==='kriteria'" x-transition>
          <h3 class="font-semibold mb-2">
            {{ 'Kriteria Seleksi' if current_lang == 'id' else 'Selection
            Criteria' }}
          </h3>
          <template x-for="(activity, aIndex) in activities" :key="aIndex">
            <div class="mb-4 p-3 border rounded-lg dark:border-gray-700">
              <h4
                class="font-medium mb-4 {{ 'text-blue-400' if current_theme == 'dark' else 'text-blue-700' }}"
                x-text="activity.nama"
              ></h4>
              <div
                class="flex items-center gap-2 mb-2 font-semibold text-sm border-b pb-1"
              >
                <div class="w-1/3">
                  {{ 'Nama Kriteria' if current_lang == 'id' else 'Criteria
                  Name' }}
                </div>
                <div class="w-1/3 pl-3">
                  {{ 'Jenis Penilaian' if current_lang == 'id' else 'Type of
                  Assessment' }}
                </div>
                <div class="w-1/3 pl-3">
                  {{ 'Skala Penilaian' if current_lang == 'id' else 'Assessment
                  Scale' }}
                </div>
                <div class="w-12 text-center">
                  {{ 'Aksi' if current_lang == 'id' else 'Action' }}
                </div>
              </div>
              <template x-for="(c, index) in activity.criteria" :key="index">
                <div class="flex items-center gap-2 mb-2">
                  <!-- Nama -->
                  <input
                    type="text"
                    x-model="c.nama"
                    class="w-1/3 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                  />

                  <!-- Jenis Penilaian -->
                  <div
                    class="w-1/3 flex relative group items-center justify-between border px-2 rounded-lg {{ 'dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'dark:bg-gray-300 dark:text-gray-900' }}"
                  >
                    <span
                      x-text="Array.isArray(c.jenis) ? c.jenis.join(', ') : (c.jenis || 'Belum diatur')"
                    ></span>
                    <button
                      @click="selectedIndex = index; this.aIndex = aIndex; if (!activities[aIndex].criteria[selectedIndex].jenis) activities[aIndex].criteria[selectedIndex].jenis = 'Kualitatif'; showModal = true;"
                      class="px-2 py-1 bg-yellow-500 hover:bg-amber-500 text-white rounded text-xs cursor-pointer"
                      title="{{ 'Edit' if current_lang == 'id' else 'Edit' }}"
                    >
                      <i class="fa-solid fa-pen-to-square"></i>
                    </button>
                  </div>

                  <!-- skala -->
                  <div class="flex items-center w-1/3">
                    <input
                      type="number"
                      x-model="c.skala"
                      min="1"
                      max="10"
                      placeholder="1-10"
                      class="w-full rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                    />
                  </div>

                  <!-- Hapus -->
                  <button
                    @click="deleteIndex = index; showDeleteModal = true"
                    class="px-2 py-1 bg-red-500 hover:bg-red-700 text-white rounded-lg text-xs cursor-pointer"
                    title="{{ 'Hapus' if current_lang == 'id' else 'Delete' }}"
                  >
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </template>

              <!-- Tambah -->
              <button
                @click="activity.criteria.push({ nama:'', skala:0, jenis: 'Kualitatif' })"
                class="px-3 py-1 bg-green-500 hover:bg-green-700 text-white rounded-lg text-sm mt-2 cursor-pointer"
              >
                {{ '+ Tambah Kriteria' if current_lang == 'id' else '+ Add
                Criteria' }}
              </button>
            </div>
          </template>

          <!-- Tombol Navigasi -->
          <div class="flex justify-between mt-6">
            <button
              @click="tab = 'kontingen'"
              class="px-4 py-2 rounded-lg cursor-pointer {{ 'bg-gray-300 hover:bg-gray-800 dark:bg-gray-700' if current_theme == 'dark' else 'bg-gray-200 hover:bg-gray-500 dark:bg-gray-400' }}"
            >
              <i class="fa-solid fa-backward"></i>
              {{ 'Kembali' if current_lang == 'id' else 'Back' }}
            </button>
            <button
              type="button"
              @click="saveConfig()"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer"
            >
              <i class="fa-solid fa-download"></i>
              {{ 'Simpan Konfigurasi' if current_lang == 'id' else 'Save
              Configuration' }}
            </button>
          </div>

          <!-- Modal Dinamis -->
          <div
            x-show="showModal"
            x-transition.opacity
            class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-300/50' }}"
          >
            <div
              x-transition.scale
              class="p-6 rounded-2xl shadow-2xl w-96 flex flex-col items-center relative bg-white {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-200' }}"
              @click.away="showModal = false"
            >
              <!-- Tombol Close -->
              <button
                @click="showModal = false"
                class="absolute top-3 right-3 dark:hover:text-red-600 transition cursor-pointer {{ 'text-gray-500 hover:text-gray-700' if current_theme == 'dark' else 'text-gray-800 hover:text-gray-900' }}"
                aria-label="Close"
              >
                <i class="fa-solid fa-xmark text-lg"></i>
              </button>

              <!-- Icon -->
              <div
                class="text-3xl mb-2 animate-bounce {{ 'text-amber-400' if current_theme == 'dark' else 'text-amber-600' }}"
              >
                <i class="fa-solid fa-chart-pie"></i>
              </div>

              <h4 class="font-semibold mb-8">
                {{ 'Atur Jenis Penilaian' if current_lang == 'id' else 'Set
                Assessment Type' }}
              </h4>

              <template
                x-if="selectedIndex !== null && activities[aIndex].criteria[selectedIndex]?.nama === 'Tes Wawancara'"
              >
                <div class="flex flex-col gap-2">
                  <label
                    ><input
                      type="checkbox"
                      value="Kepribadian"
                      @change="toggleAspect($event, selectedIndex)"
                    />
                    {{ 'Kepribadian' if current_lang == 'id' else 'Personality'
                    }}</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      value="Pengalaman Organisasi"
                      @change="toggleAspect($event, selectedIndex)"
                    />
                    {{ 'Pengalaman Organisasi' if current_lang == 'id' else
                    'Organizational Experiences' }}</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      value="Pengetahuan Kepanduan Dunia"
                      @change="toggleAspect($event, selectedIndex)"
                    />
                    {{ 'Pengetahuan Kepanduan Dunia' if current_lang == 'id'
                    else 'World Scouting Knowledge' }}</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      value="Pengetahuan Kepramukaan"
                      @change="toggleAspect($event, selectedIndex)"
                    />
                    {{ 'Pengetahuan Kepramukaan' if current_lang == 'id' else
                    'Scouting Knowledge' }}</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      value="Motivasi"
                      @change="toggleAspect($event, selectedIndex)"
                    />
                    {{ 'Motivasi' if current_lang == 'id' else 'Motivation'
                    }}</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      value="Hardskill & Softskill"
                      @change="toggleAspect($event, selectedIndex)"
                    />
                    Hardskill & Softskill</label
                  >
                </div>
              </template>

              <template
                x-if="activities[aIndex].criteria[selectedIndex]?.nama === 'Tes Pilihan Ganda'"
              >
                <div>
                  <label class="block mb-2"
                    >{{ 'Jumlah Soal' if current_lang == 'id' else 'Question
                    Amount' }}</label
                  >
                  <input
                    type="number"
                    x-model="activities[aIndex].criteria[selectedIndex].jumlahSoal"
                    min="1"
                    :class="{'w-full rounded-lg border-gray-300 dark:bg-gray-800 dark:text-white': true, 'border-red-500': errorMessage && !activities[aIndex].criteria[selectedIndex].skala}"
                  />
                </div>
              </template>

              <template
                x-if="!['Tes Wawancara','Tes Pilihan Ganda'].includes(activities[aIndex].criteria[selectedIndex]?.nama)"
              >
                <select
                  x-model="activities[aIndex].criteria[selectedIndex].jenis"
                  x-init="$watch('selectedIndex', i => { if (!activity.criteria[i].jenis) activity.criteria[i].jenis = 'Kualitatif' })"
                  class="w-full rounded-lg border-gray-300 dark:bg-gray-800 dark:text-white"
                >
                  <option value="Kualitatif">
                    {{ 'Kualitatif' if current_lang == 'id' else 'Qualitative'
                    }}
                  </option>
                  <option value="Kuantitatif">
                    {{ 'Kuantitatif' if current_lang == 'id' else 'Quantitative'
                    }}
                  </option>
                </select>
              </template>

              <div class="mt-12 flex justify-end gap-5">
                <button
                  type="button"
                  @click="showModal  = false"
                  class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white transition rounded-lg cursor-pointer"
                >
                  <i class="fa-solid fa-xmark"></i>
                  {{ 'Batal' if current_lang == 'id' else 'Cancel' }}
                </button>
                <button
                  @click="saveCriteria()"
                  :disabled="!activities[aIndex].criteria[selectedIndex].nama || !activities[aIndex].criteria[selectedIndex].skala"
                  :class="['px-4 py-2 text-white transition rounded-lg cursor-pointer', !activities[aIndex].criteria[selectedIndex].nama || !activities[aIndex].criteria[selectedIndex].skala ? 'bg-gray-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700']"
                >
                  <i class="fa-solid fa-floppy-disk"></i>
                  {{ 'Simpan' if current_lang == 'id' else 'Save' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>

  <!-- Modal Error Message -->
  <div
    x-show="errorMessage"
    x-transition.opacity
    class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-300/50' }}"
  >
    <div
      x-transition.scale
      class="p-6 rounded-2xl shadow-2xl w-96 flex flex-col items-center relative bg-white {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-200' }}"
    >
      <!-- Tombol Close -->
      <button
        @click="errorMessage = ''"
        class="absolute top-3 right-3 dark:hover:text-red-600 transition cursor-pointer {{ 'text-gray-500 hover:text-gray-700' if current_theme == 'dark' else 'text-gray-800 hover:text-gray-900' }}"
        aria-label="Close"
      >
        <i class="fa-solid fa-xmark text-lg"></i>
      </button>

      <!-- Icon -->
      <div
        class="text-3xl mb-2 animate-bounce {{ 'text-amber-400' if current_theme == 'dark' else 'text-amber-600' }}"
      >
        <i class="fa-solid fa-triangle-exclamation"></i>
      </div>

      <!-- Judul -->
      <h4
        class="text-lg font-bold mb-6 text-center {{ 'text-amber-400' if current_theme == 'dark' else 'text-amber-600' }}"
      >
        {{ 'Peringatan' if current_lang == 'id' else 'Warning' }}
      </h4>

      <!-- Pesan -->
      <p
        class="text-sm text-center mb-4 px-4 {{ 'text-gray-700 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-800' }}"
        x-text="errorMessage"
      ></p>

      <!-- Tombol Aksi -->
      <button
        @click="errorMessage = ''"
        class="mt-2 px-5 py-2 bg-red-600 hover:bg-red-800 text-white rounded-lg shadow-md transition-all duration-300 cursor-pointer"
      >
        {{ 'Tutup' if current_lang == 'id' else 'Close' }}
      </button>
    </div>
  </div>

  <!-- Modal Konfirmasi Hapus -->
  <div
    x-show="showDeleteModal"
    x-transition.opacity
    class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-300/50' }}"
  >
    <div
      x-transition.scale
      class="p-6 rounded-2xl shadow-2xl w-96 flex flex-col items-center relative bg-white {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-200' }}"
      @click.away="showDeleteModal = false"
    >
      <!-- Tombol Close -->
      <button
        @click="showDeleteModal = false"
        class="absolute top-3 right-3 dark:hover:text-red-600 transition cursor-pointer {{ 'text-gray-500 hover:text-gray-700' if current_theme == 'dark' else 'text-gray-800 hover:text-gray-900' }}"
        aria-label="Close"
      >
        <i class="fa-solid fa-xmark text-lg"></i>
      </button>

      <!-- Icon Warning -->
      <div
        class="text-4xl mb-2 animate-pulse {{ 'text-red-500' if current_theme == 'dark' else 'text-red-700' }}"
      >
        <i class="fa-solid fa-triangle-exclamation"></i>
      </div>

      <!-- Judul -->
      <h4 class="font-semibold text-lg mb-8">
        {{ 'Konfirmasi Hapus' if current_lang == 'id' else 'Delete Confirmation'
        }}
      </h4>
      <p
        class="text-sm text-center mb-6 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-800' }}"
      >
        {{ 'Apakah Anda yakin ingin menghapus kriteria ini? Tindakan ini tidak
        dapat dibatalkan.' if current_lang == 'id' else 'Are you sure you want
        to delete this criteria? This action cannot be undone.' }}
      </p>

      <!-- Tombol Aksi -->
      <div class="flex justify-center gap-3 mt-3 w-full">
        <button
          @click="showDeleteModal = false"
          class="px-4 py-2 rounded-lg cursor-pointer transition {{ 'bg-gray-300 hover:bg-gray-800 dark:bg-gray-700' if current_theme == 'dark' else 'bg-gray-200 hover:bg-gray-500 dark:bg-gray-400' }}"
        >
          <i class="fa-solid fa-xmark"></i>
          {{ 'Batal' if current_lang == 'id' else 'Cancel' }}
        </button>
        <button
          @click="criteria.splice(deleteIndex, 1); showDeleteModal = false"
          class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg cursor-pointer transition"
        >
          <i class="fa-solid fa-trash"></i>
          {{ 'Hapus' if current_lang == 'id' else 'Delete' }}
        </button>
      </div>
    </div>
  </div>
</div>
