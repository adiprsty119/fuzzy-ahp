<!DOCTYPE html>
<html class="transition duration-300 ease-in-out" lang="{{ current_lang }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <title>
      {{ 'Dashboard | SPK Pramuka' if current_lang == 'id' else 'Dashboard |
      Scout DSS' }}
    </title>

    <!-- Tailwind CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/output.css') }}"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
    />

    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Script Sidebar -->
    {% include "script_sidebar.html" %}

    <!-- Script Theme -->
    {% include 'script_theme.html' %}
  </head>
  <body
    x-data="{ ready: false, page: 'main', selectedUser: null, current_lang: '{{ current_lang }}' }"
    x-init="ready = true"
    :class="{ 'dark': $store.theme?.isDark }"
    x-bind:class="{
        'bg-background-dark text-white': $store.theme?.isDark,
        'bg-gray-100 text-black': !$store.theme?.isDark
      }"
    class="transition duration-300 ease-in-out font-sans scroll-smooth {{ 'bg-background-dark text-white' if current_theme == 'dark' else 'bg-gray-100 text-black' }}"
  >
    <div
      class="flex h-screen {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-300' }}"
    >
      <!-- Sidebar -->
      {% include 'sidebar.html' %}

      <!-- Main content -->
      <div class="flex flex-col flex-1 overflow-hidden h-full">
        <!-- Top Navbar -->
        {% include 'header.html' %}

        <!-- Page Content -->
        <main
          class="flex-1 overflow-y-auto pt-28 h-full transition-all duration-300"
          :class="Alpine.store('sidebar').open ? 'ml-[15%]' : 'ml-[1%]'"
        >
          <section
            class="flex items-center justify-center wow animate__animated animate__fadeInUp animate__delay-0.5s {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-300' }}"
          >
            <!-- Notification Box -->
            {% include 'notification_box.html' %}

            <!-- Main Content -->
            <div
              x-show="page === 'main'"
              x-transition:enter="transition ease-out duration-500"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
              x-transition:leave="transition ease-in duration-300"
              x-transition:leave-start="opacity-100 scale-100"
              x-transition:leave-end="opacity-0 scale-95"
              class="container mx-auto p-6"
            >
              <h1
                class="text-2xl font-bold mb-8 flex items-center gap-2 transition-all duration-1000"
              >
                <template
                  x-for="(crumb, index) in $store.page.breadcrumbs"
                  :key="index"
                >
                  <span>
                    <span x-text="crumb"></span>
                    <span x-show="index < $store.page.breadcrumbs.length - 1">
                      â†’
                    </span>
                  </span>
                </template>
              </h1>

              <div class="w-full flex-row">
                <!-- Content 1 -->
                <div
                  class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"
                >
                  <!-- Tambah & Kelola Pengguna -->
                  <div
                    x-data="{ openAddUser: false, openImport: false }"
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div class="p-3 bg-blue-100 text-blue-600 rounded-full">
                        <i class="fa-solid fa-user-plus text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Tambah & Kelola Pengguna' if current_lang == 'id'
                        else 'Add & Manage Users' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Kelola akun peserta, penilai, dan admin pada sistem.'
                      if current_lang == 'id' else 'Manage participant,
                      evaluator, and admin accounts.' }}
                    </p>
                    <div class="flex flex-wrap gap-2">
                      <button
                        @click="openAddUser = true"
                        class="flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-user-plus mr-2"></i>
                        {{ 'Tambah Pengguna' if current_lang == 'id' else 'Add
                        User' }}
                      </button>

                      <!-- Modal Tambah Pengguna -->
                      <div
                        x-show="openAddUser"
                        x-cloak
                        x-transition.opacity
                        class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-400/50' }}"
                      >
                        <div
                          x-transition.scale
                          class="bg-white rounded-2xl shadow-lg w-full max-w-lg p-6 {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-200' }}"
                          @click.away="openAddUser = false"
                        >
                          <!-- Header -->
                          <div
                            class="flex justify-between items-center border-b pb-3 mb-12"
                          >
                            <h2
                              class="text-xl font-semibold {{ 'text-gray-800 dark:text-gray-200' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-900' }}"
                            >
                              {{ 'Tambah Pengguna Baru' if current_lang == 'id'
                              else 'Add New User' }}
                            </h2>
                            <button
                              @click="openAddUser = false"
                              class="text-gray-500 hover:text-gray-800 dark:hover:text-red-700 cursor-pointer"
                            >
                              <i class="fa-solid fa-xmark text-lg"></i>
                            </button>
                          </div>

                          <!-- Form -->
                          <form
                            action="{{ url_for('admin_add_user') }}"
                            method="POST"
                            class="space-y-4"
                          >
                            <!-- CSRF Token -->
                            <input
                              type="hidden"
                              name="csrf_token"
                              value="{{ csrf_token() }}"
                            />

                            <!-- Nama Lengkap -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >{{ 'Nama Lengkap' if current_lang == 'id' else
                                'Full Name' }}</label
                              >
                              <input
                                type="text"
                                id="fullName"
                                name="fullName"
                                class="w-full px-3 py-2 border rounded-lg focus:ring focus:ring-blue-400 {{ 'dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'dark:bg-gray-100 dark:text-gray-900' }}"
                                placeholder="Masukkan nama lengkap"
                                required
                              />
                            </div>

                            <!-- Email -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >Email</label
                              >
                              <input
                                type="email"
                                id="email"
                                name="email"
                                class="w-full px-3 py-2 border rounded-lg focus:ring focus:ring-blue-400 {{ 'dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'dark:bg-gray-100 dark:text-gray-900' }}"
                                placeholder="contoh@email.com"
                                required
                              />
                            </div>

                            <!-- Username -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >Username</label
                              >
                              <input
                                type="text"
                                id="username"
                                name="username"
                                class="w-full px-3 py-2 border rounded-lg {{ 'dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400' if current_theme == 'dark' else 'dark:bg-gray-300 dark:text-gray-900 focus:ring focus:ring-blue-400' }}"
                                placeholder="Masukkan username"
                                required
                              />
                            </div>

                            <!-- Password -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >{{ 'Kata Sandi' if current_lang == 'id' else
                                'Password' }}</label
                              >
                              <input
                                type="password"
                                id="password"
                                name="password"
                                class="w-full px-3 py-2 border rounded-lg {{ 'dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400' if current_theme == 'dark' else 'dark:bg-gray-300 dark:text-gray-900 focus:ring focus:ring-blue-400' }}"
                                placeholder="Minimal 8 karakter"
                                required
                              />
                            </div>

                            <!-- Konfirmasi Password -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >{{ 'Konfirmasi Kata Sandi' if current_lang ==
                                'id' else 'Confirm Password' }}</label
                              >
                              <input
                                type="password"
                                id="confirmPassword"
                                name="confirmPassword"
                                class="w-full px-3 py-2 border rounded-lg {{ 'dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400' if current_theme == 'dark' else 'dark:bg-gray-300 dark:text-gray-900 focus:ring focus:ring-blue-400' }}"
                                placeholder="Minimal 8 karakter"
                                required
                              />
                            </div>

                            <!-- Role -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >{{ 'Role Pengguna' if current_lang == 'id' else
                                'User Role' }}</label
                              >
                              <select
                                name="level"
                                id="level"
                                class="w-full px-3 py-2 border rounded-lg {{ 'dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400' if current_theme == 'dark' else 'dark:bg-gray-300 dark:text-gray-900 focus:ring focus:ring-blue-400' }}"
                                required
                              >
                                <option value="peserta">
                                  {{ 'Peserta' if current_lang == 'id' else
                                  'Participant' }}
                                </option>
                                <option value="penilai">
                                  {{ 'Penilai' if current_lang == 'id' else
                                  'Evaluator' }}
                                </option>
                                <option value="admin">
                                  {{ 'Admin' if current_lang == 'id' else
                                  'Admin' }}
                                </option>
                              </select>
                            </div>

                            <!-- Tombol Aksi -->
                            <div class="flex justify-end gap-3 pt-4">
                              <button
                                type="button"
                                @click="openAddUser = false"
                                class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition cursor-pointer"
                              >
                                <i class="fa-solid fa-xmark"></i>
                                {{ 'Batal' if current_lang == 'id' else 'Cancel'
                                }}
                              </button>
                              <button
                                type="submit"
                                class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition cursor-pointer"
                              >
                                <i class="fa-solid fa-floppy-disk"></i>
                                {{ 'Simpan' if current_lang == 'id' else 'Save'
                                }}
                              </button>
                            </div>
                          </form>
                        </div>
                      </div>
                      <!-- Import Data -->

                      <button
                        @click="openImport = true"
                        class="flex items-center px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-upload mr-2"></i>
                        {{ 'Import Data' if current_lang == 'id' else 'Import
                        Data' }}
                      </button>

                      <!-- Modal Import Data -->
                      <div
                        x-show="openImport"
                        x-cloak
                        x-transition.opacity
                        class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-400/50' }}"
                      >
                        <div
                          class="bg-white rounded-2xl shadow-lg w-full max-w-lg p-6 {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-200' }}"
                          @click.away="openImport = false"
                          x-data="{ loading: false, fileName: '', previewData: null }"
                        >
                          <!-- Header -->
                          <div
                            class="flex justify-between items-center border-b pb-3 mb-12"
                          >
                            <div
                              class="flex justify-between items-start gap-2.5"
                            >
                              <i
                                class="fa-solid fa-file-import size-3.5 mt-2 text-green-700"
                              ></i>
                              <h2
                                class="text-xl font-semibold {{ 'text-gray-800 dark:text-gray-200' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-900' }}"
                              >
                                {{ 'Import Data Pengguna' if current_lang ==
                                'id' else 'Import User Data' }}
                              </h2>
                            </div>
                            <button
                              @click="openImport = false"
                              class="cursor-pointer dark:hover:text-red-600 {{ 'text-gray-500 hover:text-gray-800' if current_theme == 'dark' else 'text-gray-700 hover:text-gray-800' }}"
                            >
                              <i class="fa-solid fa-xmark text-lg"></i>
                            </button>
                          </div>

                          <!-- Form Import -->
                          <form
                            action="{{ url_for('admin_import_users') }}"
                            method="POST"
                            enctype="multipart/form-data"
                            @submit="loading = true"
                            class="space-y-4"
                          >
                            <!-- CSRF Token -->
                            <input
                              type="hidden"
                              name="csrf_token"
                              value="{{ csrf_token() }}"
                            />
                            <!-- Input File -->
                            <div>
                              <label
                                class="block text-sm font-medium mb-1 {{ 'text-gray-200 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-800 dark:text-gray-900' }}"
                              >
                                {{ 'Pilih File' if current_lang == 'id' else
                                'Choose File' }}
                              </label>
                              <div
                                class="border-2 border-dashed rounded-xl p-4 text-center cursor-pointer transition {{ 'hover:bg-gray-50 dark:hover:bg-gray-800' if current_theme == 'dark' else 'hover:bg-gray-50 dark:hover:bg-gray-300' }}"
                                @click="$refs.fileInput.click()"
                              >
                                <input
                                  type="file"
                                  x-ref="fileInput"
                                  name="file"
                                  accept=".csv,.xls,.xlsx"
                                  @change="fileName = $refs.fileInput.files[0]?.name || ''; previewData = null"
                                  class="hidden"
                                  required
                                />
                                <template x-if="!fileName">
                                  <p
                                    class="text-sm {{ 'text-gray-500 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-800 dark:text-gray-900' }}"
                                  >
                                    <i
                                      class="fa-solid fa-cloud-upload-alt mr-1"
                                    ></i>
                                    {{ 'Klik untuk memilih file' if current_lang
                                    == 'id' else 'Click to select file' }}
                                  </p>
                                </template>
                                <template x-if="fileName">
                                  <p
                                    class="font-medium {{ 'text-gray-400 dark:text-gray-200' if current_theme == 'dark' else 'text-gray-800 dark:text-gray-900' }}"
                                  >
                                    <i
                                      class="fa-solid fa-file mr-2 {{ 'text-blue-500' if current_theme == 'dark' else 'text-blue-700' }}"
                                    ></i>
                                    <span x-text="fileName"></span>
                                  </p>
                                </template>
                              </div>
                            </div>

                            <!-- Progress Indicator -->
                            <template x-if="loading">
                              <div
                                class="flex items-center justify-center text-blue-500 mt-2"
                              >
                                <i
                                  class="fa-solid fa-spinner animate-spin text-xl mr-2"
                                ></i>
                                <span
                                  >{{'Mengupload dan memproses...' if
                                  current_lang == 'id' else 'Uploading and
                                  processing...' }}</span
                                >
                              </div>
                            </template>

                            <!-- Tombol Aksi -->
                            <div class="flex justify-end gap-3 pt-4">
                              <button
                                type="button"
                                @click="openImport = false"
                                class="px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600 transition cursor-pointer"
                              >
                                {{ 'Batal' if current_lang == 'id' else 'Cancel'
                                }}
                              </button>
                              <button
                                type="submit"
                                :disabled="loading"
                                class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition cursor-pointer"
                              >
                                {{ 'Upload' if current_lang == 'id' else
                                'Upload' }}
                              </button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Role & Hak Akses -->
                  <div
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div
                        class="p-3 bg-purple-100 text-purple-600 rounded-full"
                      >
                        <i class="fa-solid fa-shield-halved text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Role & Hak Akses' if current_lang == 'id' else
                        'Roles & Access Rights' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Atur role pengguna dan hak akses sistem.' if
                      current_lang == 'id' else 'Manage user roles and access
                      rights.' }}
                    </p>
                    <button
                      @click="
                        page = 'role';
                        $store.page.breadcrumbs =
                          current_lang === 'id'
                            ? ['Manajemen Pengguna', 'Role & Hak Akses']
                            : ['Users Management', 'Role & Access']
                      "
                      class="flex items-center px-4 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 transition cursor-pointer"
                    >
                      <i class="fa-solid fa-user-shield mr-2"></i>
                      {{ 'Kelola Role' if current_lang == 'id' else 'Manage
                      Roles' }}
                    </button>
                  </div>

                  <!-- Log Aktivitas -->
                  <div
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div class="p-3 bg-green-100 text-green-600 rounded-full">
                        <i class="fa-solid fa-list text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Log Aktivitas' if current_lang == 'id' else
                        'Activity Log' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Lihat riwayat login dan aktivitas pengguna.' if
                      current_lang == 'id' else 'View login history and user
                      activities.' }}
                    </p>
                    <button
                      @click="
                        page = 'log';
                        $store.page.breadcrumbs =
                          current_lang === 'id'
                            ? ['Manajemen Pengguna', 'Log Aktivitas']
                            : ['Users Management', 'Activity Log']
                      "
                      class="flex items-center px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition cursor-pointer"
                    >
                      <i class="fa-solid fa-clock-rotate-left mr-2"></i>
                      {{ 'Lihat Log' if current_lang == 'id' else 'View Logs' }}
                    </button>
                  </div>

                  <!-- Status Akun -->
                  <div
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div class="p-3 bg-red-100 text-red-600 rounded-full">
                        <i class="fa-solid fa-user-lock text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Status Akun' if current_lang == 'id' else 'Account
                        Status' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Aktifkan/nonaktifkan akun pengguna atau reset
                      password.' if current_lang == 'id' else
                      'Activate/deactivate accounts or reset passwords.' }}
                    </p>
                    <div class="flex flex-wrap gap-2">
                      <button
                        class="flex items-center px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-ban mr-2"></i> {{ 'Nonaktifkan' if
                        current_lang == 'id' else 'Deactivate' }}
                      </button>
                      <button
                        class="flex items-center px-4 py-2 rounded-lg bg-yellow-500 text-white hover:bg-yellow-600 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-key mr-2"></i> {{ 'Reset Password'
                        if current_lang == 'id' else 'Reset Password' }}
                      </button>
                    </div>
                  </div>

                  <!-- Profil Peserta -->
                  <div
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div class="p-3 bg-teal-100 text-teal-600 rounded-full">
                        <i class="fa-solid fa-id-card text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Profil Peserta' if current_lang == 'id' else
                        'Participant Profile' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Kelola data diri dan dokumen pendukung peserta.' if
                      current_lang == 'id' else 'Manage participant profile and
                      documents.' }}
                    </p>
                    <button
                      @click="
                        page = 'profil';
                        $store.page.breadcrumbs =
                          current_lang === 'id'
                            ? ['Manajemen Pengguna', 'Profile Peserta']
                            : ['Users Management', 'Users Profile']
                      "
                      class="flex items-center px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700 transition cursor-pointer"
                    >
                      <i class="fa-solid fa-user-gear mr-2"></i>
                      {{ 'Kelola Profil' if current_lang == 'id' else 'Manage
                      Profile' }}
                    </button>
                  </div>
                </div>
              </div>
              <hr class="mt-10" />

              <!-- Content 2 -->
              <div class="mt-10">
                <h1 class="text-2xl font-bold mb-8">
                  {{ 'Daftar Pengguna' if current_lang == 'id' else 'Users List'
                  }}
                </h1>
                <!-- Search Bar -->
                <div
                  class="flex flex-wrap items-center justify-between gap-3 mb-14"
                >
                  <div class="flex flex-wrap items-center gap-3">
                    <input
                      type="text"
                      placeholder="Cari pengguna..."
                      class="px-4 py-2 border rounded-lg {{ 'dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'dark:bg-gray-100 dark:text-gray-900' }}"
                    />

                    <select
                      class="px-4 py-2 border rounded-lg {{ 'dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'dark:bg-gray-100 dark:text-gray-900' }}"
                    >
                      <option>
                        {{ 'Semua Role' if current_lang == 'id' else 'All Roles'
                        }}
                      </option>
                      <option>
                        {{ 'Peserta' if current_lang == 'id' else 'Participant'
                        }}
                      </option>
                      <option>
                        {{ 'Penilai' if current_lang == 'id' else 'Evaluator' }}
                      </option>
                      <option>Admin</option>
                    </select>

                    <select
                      class="px-4 py-2 border rounded-lg {{ 'dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'dark:bg-gray-100 dark:text-gray-900' }}"
                    >
                      <option>Status</option>
                      <option>
                        {{ 'Aktif' if current_lang == 'id' else 'Active' }}
                      </option>
                      <option>
                        {{ 'Nonaktif' if current_lang == 'id' else 'Inactive' }}
                      </option>
                    </select>
                  </div>

                  <!-- Tombol di kanan -->
                  <button
                    type="button"
                    class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition cursor-pointer"
                    @click="
                      fetch('{{ url_for('download_users') }}')
                        .then(res => res.blob())
                        .then(blob => {const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'users.csv'; document.body.appendChild(a); a.click(); a.remove(); window.URL.revokeObjectURL(url);});"
                  >
                    <i class="fa-solid fa-download mr-2"></i>
                    {{ 'Unduh' if current_lang == 'id' else 'Download ' }}
                  </button>
                </div>

                <!-- Daftar Pengguna -->
                <div
                  class="overflow-x-auto mb-10 shadow rounded-lg {{ 'bg-white dark:bg-gray-800' if current_theme == 'dark' else 'bg-white dark:bg-gray-200' }}"
                >
                  <table class="w-full text-left border-collapse">
                    <thead>
                      <tr
                        class="{{ 'bg-gray-300 dark:bg-gray-900 text-gray-700 dark:text-gray-300' if current_theme == 'dark' else 'bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-100' }}"
                      >
                        <th class="border p-2 px-4 py-2">No</th>
                        <th class="border p-2 px-4 py-2">
                          {{ 'Nama Lengkap' if current_lang == 'id' else 'Full
                          Name' }}
                        </th>
                        <th class="border p-2 px-4 py-2">Email</th>
                        <th class="border p-2 px-4 py-2">Username</th>
                        <th class="border p-2 px-4 py-2">Role</th>
                        <th class="border p-2 px-4 py-2">Status</th>
                        <th class="border p-2 px-4 py-2">
                          {{ 'Aksi' if current_lang == 'id' else 'Action' }}
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for user in users %}
                      <tr class="border-b dark:border-gray-700">
                        <td class="border p-2">{{ loop.index }}</td>
                        <td class="border p-2 px-4 py-2">
                          {{ user.nama_lengkap }}
                        </td>
                        <td class="border p-2 px-4 py-2">{{ user.email }}</td>
                        <td class="border p-2 px-4 py-2">
                          {{ user.username }}
                        </td>
                        <td class="border p-2 px-4 py-2">{{ user.level }}</td>
                        <td class="border p-2 px-4 py-2">
                          <span
                            class="px-2 py-1 text-xs rounded-lg"
                            :class="{
                              'bg-green-100 text-green-600': '{{ user.status|lower }}' === 'aktif',
                              'bg-red-100 text-red-600': '{{ user.status|lower }}' !== 'aktif'
                            }"
                          >
                            {{ user.status }}
                          </span>
                        </td>
                        <td
                          class="border p-2 px-4 py-2 flex gap-2"
                          x-data="{ showModal: false, deleteUrl: '{{ url_for('delete_user', user_id=user.id) }}', username: '{{ user.username }}' }"
                        >
                          <!-- prettier-ignore -->
                          <button
                            @click="selectedUser={id:{{user.id}},nama_lengkap:'{{user.nama_lengkap}}',email:'{{user.email}}',username:'{{user.username}}',jenis_kelamin:'{{user.jenis_kelamin or ''}}',usia:{{user.usia or 0}},nomor_hp:'{{user.nomor_hp or ''}}',level:'{{user.level}}',status:'{{user.status}}',foto:'{{user.foto or ''}}'};page='edit';$store.page.breadcrumbs=['Manajemen Pengguna','Edit User']"
                            class="px-3 py-1 rounded bg-blue-500 hover:bg-blue-700 text-white text-xs cursor-pointer"
                          >
                            Edit
                          </button>

                          <button
                            type="button"
                            @click="showModal = true; username = '{{ user.username }}'; deleteUrl = '{{ url_for('delete_user', user_id=user.id) }}';"
                            class="px-3 py-1 rounded bg-red-500 hover:bg-red-700 text-white text-xs cursor-pointer"
                          >
                            {{ 'Hapus' if current_lang == 'id' else 'Delete' }}
                          </button>

                          <!-- Modal Konfirmasi Hapus -->
                          <div
                            x-show="showModal"
                            @keydown.escape.window="showModal = false"
                            x-transition.opacity.duration.300ms
                            x-cloak
                            class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-400/50' }}"
                          >
                            <div
                              x-transition.scale.80.duration.300ms
                              class="p-6 rounded-2xl shadow-2xl w-96 flex flex-col items-center relative bg-white {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-200' }}"
                              @click.away="showModal = false"
                            >
                              <!-- Tombol Close -->
                              <button
                                @click="showModal = false"
                                class="absolute top-3 right-3 dark:hover:text-red-600 transition cursor-pointer {{ 'text-gray-500 hover:text-gray-700' if current_theme == 'dark' else 'text-gray-800 hover:text-gray-900' }}"
                                aria-label="Close"
                              >
                                <i class="fa-solid fa-xmark text-lg"></i>
                              </button>

                              <!-- Icon -->
                              <div
                                class="text-3xl mb-2 animate-bounce text-red-600"
                              >
                                <i class="fa-solid fa-trash"></i>
                              </div>

                              <h2
                                class="text-lg font-semibold mb-6 {{ 'text-red-700' if current_theme == 'dark' else 'text-red-800' }}"
                              >
                                {{ 'Konfirmasi Hapus' if current_lang == 'id'
                                else 'Confirm Delete' }}
                              </h2>

                              <p class="text-gray-300 text-center mb-10">
                                {{ 'Apakah Anda yakin ingin menghapus pengguna'
                                if current_lang == 'id' else 'Are you sure you
                                want to delete user' }}
                                <span
                                  class="font-semibold text-red-600"
                                  x-text="username"
                                ></span
                                >?
                              </p>

                              <form :action="deleteUrl" method="post">
                                <input
                                  type="hidden"
                                  name="csrf_token"
                                  value="{{ csrf_token() }}"
                                />
                                <div class="flex justify-end gap-5 mb-5">
                                  <button
                                    type="button"
                                    @click="showModal = false"
                                    class="px-4 py-2 rounded-lg cursor-pointer bg-gray-300 hover:bg-gray-400 text-gray-800"
                                  >
                                    {{ 'Batal' if current_lang == 'id' else
                                    'Cancel' }}
                                  </button>
                                  <button
                                    type="submit"
                                    class="px-4 py-2 rounded-lg cursor-pointer bg-red-600 hover:bg-red-700 text-white"
                                  >
                                    {{ 'Hapus' if current_lang == 'id' else
                                    'Delete' }}
                                  </button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </td>
                      </tr>
                      {% else %}
                      <tr>
                        <td
                          colspan="7"
                          class="p-4 text-center text-gray-500 mt-4"
                        >
                          {{ 'Tidak ada data' if current_lang == 'id' else 'No
                          data available' }}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- === (Tabs) === -->
            <template x-if="page === 'edit'">
              {% include 'manajemen-pengguna/edit_data_user.html' %}
            </template>
            {%include 'manajemen-pengguna/kelola_role.html'%} {%include
            'manajemen-pengguna/log_activity.html'%} {%include
            'manajemen-pengguna/kelola_profil.html'%}
          </section>
        </main>
      </div>
    </div>

    <!-- Notifikasi Flash Modal -->
    {% with flashed = get_flashed_messages(with_categories=True) %} {% if
    flashed %}
    <div
      x-data="{ showFlash: true }"
      x-init="setTimeout(() => showFlash = false, 5000)"
      x-show="showFlash"
      x-transition
      x-cloak
    >
      {% for cat, msg in flashed %} {% set category = cat %} {% if msg is
      mapping %} {% set title = msg.title %} {% set message = msg.message %} {%
      set category = msg.category or category %} {% else %} {% set title =
      category|capitalize %} {% set message = msg %} {% endif %}

      <div
        class="fixed bottom-6 right-6 z-50 flex items-center gap-3 px-6 py-4 rounded-2xl shadow-xl border {% if category == 'success' %} bg-green-600 text-white border-green-500 {% elif category in ['danger', 'error'] %} bg-red-600 text-white border-red-500 {% elif category == 'warning' %} bg-yellow-500 text-gray-900 border-yellow-400 {% else %} bg-gray-800 text-white border-gray-700 {% endif %}"
        x-show="showFlash"
        x-transition
      >
        <i
          class="fa-solid {% if category == 'success' %} fa-circle-check {% elif category in ['danger', 'error'] %} fa-triangle-exclamation {% elif category == 'warning' %} fa-exclamation-circle {% else %} fa-info-circle {% endif %} text-lg"
        ></i>
        <div>
          <strong>{{ title }}</strong><br />
          <span class="text-sm">{{ message }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- Animation & Notification Script -->
    {% include 'script_animation.html' %} {% include 'script_notification.html'
    %}
  </body>
</html>
