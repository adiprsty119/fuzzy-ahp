<!DOCTYPE html>
<html class="transition duration-300 ease-in-out" lang="{{ current_lang }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <title>
      {{ 'Dashboard | SPK Pramuka' if current_lang == 'id' else 'Dashboard |
      Scout DSS' }}
    </title>

    <!-- Tailwind CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/output.css') }}"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
    />

    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Script Sidebar -->
    {% include "script_sidebar.html" %}

    <!-- Script Theme -->
    {% include 'script_theme.html' %}
  </head>
  <body
    x-data="{ ready: false }"
    x-init="ready = true"
    :class="{ 'dark': $store.theme?.isDark }"
    x-bind:class="{
        'bg-background-dark text-white': $store.theme?.isDark,
        'bg-gray-100 text-black': !$store.theme?.isDark
      }"
    class="transition duration-300 ease-in-out font-sans scroll-smooth {{ 'bg-background-dark text-white' if current_theme == 'dark' else 'bg-gray-100 text-black' }}"
  >
    <div
      class="flex h-screen {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-300' }}"
    >
      <!-- Sidebar -->
      {% include 'sidebar.html' %}

      <!-- Main content -->
      <div class="flex flex-col flex-1 overflow-hidden h-full">
        <!-- Top Navbar -->
        {% include 'header.html' %}

        <!-- Page Content -->
        <main
          class="flex-1 overflow-y-auto pt-28 h-full transition-all duration-300"
          :class="Alpine.store('sidebar').open ? 'ml-[15%]' : 'ml-[1%]'"
        >
          <section
            class="flex items-center justify-center wow animate__animated animate__fadeInUp animate__delay-0.5s {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-300' }}"
          >
            <!-- Notification Box -->
            {% include 'notification_box.html' %}

            <!-- Content 1 -->
            <div class="container mx-auto p-6">
              <h1 class="text-2xl font-bold mb-8">
                {{ 'Manajemen Pengguna' if current_lang == 'id' else 'User
                Management' }}
              </h1>
              <div class="w-full flex-row">
                <!-- Grid Layout -->
                <div
                  class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"
                >
                  <!-- Tambah & Kelola Pengguna -->
                  <div
                    x-data="{ openAddUser: false, openImport: false }"
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div class="p-3 bg-blue-100 text-blue-600 rounded-full">
                        <i class="fa-solid fa-user-plus text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Tambah & Kelola Pengguna' if current_lang == 'id'
                        else 'Add & Manage Users' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Kelola akun peserta, penilai, dan admin pada sistem.'
                      if current_lang == 'id' else 'Manage participant,
                      evaluator, and admin accounts.' }}
                    </p>
                    <div class="flex flex-wrap gap-2">
                      <!-- Tambah Pengguna -->
                      <button
                        @click="openAddUser = true"
                        class="flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-user-plus mr-2"></i>
                        {{ 'Tambah Pengguna' if current_lang == 'id' else 'Add
                        User' }}
                      </button>

                      <!-- Modal Tambah Pengguna -->
                      <div
                        x-show="openAddUser"
                        x-cloak
                        class="fixed inset-0 flex items-center justify-center z-50 bg-black/50"
                      >
                        <div
                          class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg w-full max-w-lg p-6 ml-[10%] mt-[5%]"
                          @click.away="openAddUser = false"
                        >
                          <!-- Header -->
                          <div
                            class="flex justify-between items-center border-b pb-3 mb-12"
                          >
                            <h2
                              class="text-xl font-semibold text-gray-800 dark:text-gray-200"
                            >
                              {{ 'Tambah Pengguna Baru' if current_lang == 'id'
                              else 'Add New User' }}
                            </h2>
                            <button
                              @click="openAddUser = false"
                              class="text-gray-500 hover:text-gray-800 dark:hover:text-red-700 cursor-pointer"
                            >
                              <i class="fa-solid fa-xmark text-lg"></i>
                            </button>
                          </div>

                          <!-- Form -->
                          <form
                            action="{{ url_for('admin_add_user') }}"
                            method="POST"
                            class="space-y-4"
                          >
                            <!-- CSRF Token -->
                            <input
                              type="hidden"
                              name="csrf_token"
                              value="{{ csrf_token() }}"
                            />

                            <!-- Nama Lengkap -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >{{ 'Nama Lengkap' if current_lang == 'id' else
                                'Full Name' }}</label
                              >
                              <input
                                type="text"
                                name="nama_lengkap"
                                class="w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400"
                                placeholder="Masukkan nama lengkap"
                                required
                              />
                            </div>

                            <!-- Email -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >Email</label
                              >
                              <input
                                type="email"
                                name="email"
                                class="w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400"
                                placeholder="contoh@email.com"
                                required
                              />
                            </div>

                            <!-- Username -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >Username</label
                              >
                              <input
                                type="text"
                                name="username"
                                class="w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400"
                                placeholder="Masukkan username"
                                required
                              />
                            </div>

                            <!-- Password -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >Password</label
                              >
                              <input
                                type="password"
                                name="password"
                                class="w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400"
                                placeholder="Minimal 6 karakter"
                                required
                              />
                            </div>

                            <!-- Role -->
                            <div>
                              <label class="block text-sm font-medium mb-1"
                                >{{ 'Role Pengguna' if current_lang == 'id' else
                                'User Role' }}</label
                              >
                              <select
                                name="role"
                                class="w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400"
                                required
                              >
                                <option value="participant">
                                  {{ 'Peserta' if current_lang == 'id' else
                                  'Participant' }}
                                </option>
                                <option value="evaluator">
                                  {{ 'Penilai' if current_lang == 'id' else
                                  'Evaluator' }}
                                </option>
                                <option value="admin">
                                  {{ 'Admin' if current_lang == 'id' else
                                  'Admin' }}
                                </option>
                              </select>
                            </div>

                            <!-- Tombol Aksi -->
                            <div class="flex justify-end gap-3 pt-4">
                              <button
                                type="button"
                                @click="openAddUser = false"
                                class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition cursor-pointer"
                              >
                                <i class="fa-solid fa-xmark"></i>
                                {{ 'Batal' if current_lang == 'id' else 'Cancel'
                                }}
                              </button>
                              <button
                                type="submit"
                                class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition cursor-pointer"
                              >
                                <i class="fa-solid fa-floppy-disk"></i>
                                {{ 'Simpan' if current_lang == 'id' else 'Save'
                                }}
                              </button>
                            </div>
                          </form>
                        </div>
                      </div>

                      <!-- Import Data -->
                      <button
                        @click="openImport = true"
                        class="flex items-center px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-upload mr-2"></i>
                        {{ 'Import Data' if current_lang == 'id' else 'Import
                        Data' }}
                      </button>

                      <!-- Modal Import Data -->
                      <div
                        x-show="openImport"
                        x-cloak
                        class="fixed inset-0 flex items-center justify-center z-50 bg-black/50"
                      >
                        <div
                          class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg w-full max-w-lg p-6"
                          @click.away="openImport = false"
                        >
                          <!-- Header -->
                          <div
                            class="flex justify-between items-center border-b pb-3 mb-12"
                          >
                            <h2
                              class="text-xl font-semibold text-gray-800 dark:text-gray-200"
                            >
                              {{ 'Import Data Pengguna' if current_lang == 'id'
                              else 'Import User Data' }}
                            </h2>
                            <button
                              @click="openImport = false"
                              class="text-gray-500 hover:text-gray-800 dark:hover:text-gray-300 cursor-pointer"
                            >
                              <i class="fa-solid fa-xmark text-lg"></i>
                            </button>
                          </div>

                          <!-- Form Import -->
                          <form
                            action="{{ url_for('admin_import_users') }}"
                            method="POST"
                            enctype="multipart/form-data"
                            class="space-y-4"
                          >
                            <!-- CSRF Token -->
                            <input
                              type="hidden"
                              name="csrf_token"
                              value="{{ csrf_token() }}"
                            />

                            <div>
                              <label class="block text-sm font-medium mb-1">
                                {{ 'Pilih File (CSV/Excel)' if current_lang ==
                                'id' else 'Choose File (CSV/Excel)' }}
                              </label>
                              <input
                                type="file"
                                name="file"
                                accept=".csv, .xls, .xlsx"
                                class="w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:text-white focus:ring focus:ring-blue-400"
                                required
                              />
                            </div>

                            <!-- Tombol Aksi -->
                            <div class="flex justify-end gap-3 pt-4">
                              <button
                                type="button"
                                @click="openImport = false"
                                class="px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600 transition cursor-pointer"
                              >
                                {{ 'Batal' if current_lang == 'id' else 'Cancel'
                                }}
                              </button>
                              <button
                                type="submit"
                                class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition cursor-pointer"
                              >
                                {{ 'Upload' if current_lang == 'id' else
                                'Upload' }}
                              </button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Role & Hak Akses -->
                  <div
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div
                        class="p-3 bg-purple-100 text-purple-600 rounded-full"
                      >
                        <i class="fa-solid fa-shield-halved text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Role & Hak Akses' if current_lang == 'id' else
                        'Roles & Access Rights' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Atur role pengguna dan hak akses sistem.' if
                      current_lang == 'id' else 'Manage user roles and access
                      rights.' }}
                    </p>
                    <button
                      class="flex items-center px-4 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 transition cursor-pointer"
                    >
                      <i class="fa-solid fa-user-shield mr-2"></i>
                      {{ 'Kelola Role' if current_lang == 'id' else 'Manage
                      Roles' }}
                    </button>
                  </div>

                  <!-- Log Aktivitas -->
                  <div
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div class="p-3 bg-green-100 text-green-600 rounded-full">
                        <i class="fa-solid fa-list text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Log Aktivitas' if current_lang == 'id' else
                        'Activity Log' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Lihat riwayat login dan aktivitas pengguna.' if
                      current_lang == 'id' else 'View login history and user
                      activities.' }}
                    </p>
                    <button
                      @click="openLogs = true"
                      class="flex items-center px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition cursor-pointer"
                    >
                      <i class="fa-solid fa-clock-rotate-left mr-2"></i>
                      {{ 'Lihat Log' if current_lang == 'id' else 'View Logs' }}
                    </button>

                    <!-- Modal Log -->
                    <div x-data="{ openLogs: false, logs: [] }">
                      <div
                        x-show="openLogs"
                        x-cloak
                        class="fixed inset-0 flex items-center justify-center z-50 bg-black/50"
                      >
                        <div
                          class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg w-full max-w-4xl p-6 relative"
                        >
                          <!-- Header -->
                          <div
                            class="flex justify-between items-center border-b pb-3 mb-4"
                          >
                            <h2
                              class="text-xl font-semibold text-gray-800 dark:text-gray-200"
                            >
                              {{ 'Log Aktivitas' if current_lang == 'id' else
                              'Activity Logs' }}
                            </h2>
                            <button
                              @click="openLogs = false"
                              class="text-gray-500 hover:text-gray-800 dark:hover:text-gray-300 cursor-pointer"
                            >
                              <i class="fa-solid fa-xmark text-lg"></i>
                            </button>
                          </div>

                          <!-- Isi Log -->
                          <div class="overflow-y-auto max-h-[70vh]">
                            <template x-for="(log, index) in logs" :key="index">
                              <div class="p-3 border-b dark:border-gray-700">
                                <p
                                  class="text-sm text-gray-700 dark:text-gray-300"
                                  x-text="log.message"
                                ></p>
                                <span
                                  class="text-xs text-gray-500 dark:text-gray-400"
                                  x-text="log.timestamp"
                                ></span>
                              </div>
                            </template>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Status Akun -->
                  <div
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div class="p-3 bg-red-100 text-red-600 rounded-full">
                        <i class="fa-solid fa-user-lock text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Status Akun' if current_lang == 'id' else 'Account
                        Status' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Aktifkan/nonaktifkan akun pengguna atau reset
                      password.' if current_lang == 'id' else
                      'Activate/deactivate accounts or reset passwords.' }}
                    </p>
                    <div class="flex flex-wrap gap-2">
                      <button
                        class="flex items-center px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-ban mr-2"></i> {{ 'Nonaktifkan' if
                        current_lang == 'id' else 'Deactivate' }}
                      </button>
                      <button
                        class="flex items-center px-4 py-2 rounded-lg bg-yellow-500 text-white hover:bg-yellow-600 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-key mr-2"></i> {{ 'Reset Password'
                        if current_lang == 'id' else 'Reset Password' }}
                      </button>
                    </div>
                  </div>

                  <!-- Profil Peserta -->
                  <div
                    class="p-6 bg-white rounded-2xl shadow-md transition {{ 'dark:bg-gray-900 hover:shadow-yellow-300' if current_theme == 'dark' else 'dark:bg-gray-100 hover:shadow-gray-700' }}"
                  >
                    <div class="flex items-center mb-4">
                      <div class="p-3 bg-teal-100 text-teal-600 rounded-full">
                        <i class="fa-solid fa-id-card text-xl"></i>
                      </div>
                      <h2 class="ml-3 text-lg font-semibold">
                        {{ 'Profil Peserta' if current_lang == 'id' else
                        'Participant Profile' }}
                      </h2>
                    </div>
                    <p
                      class="text-sm mb-4 {{ 'text-gray-600 dark:text-gray-300' if current_theme == 'dark' else 'text-gray-900 dark:text-gray-600' }}"
                    >
                      {{ 'Kelola data diri dan dokumen pendukung peserta.' if
                      current_lang == 'id' else 'Manage participant profile and
                      documents.' }}
                    </p>
                    <button
                      class="flex items-center px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700 transition cursor-pointer"
                    >
                      <i class="fa-solid fa-user-gear mr-2"></i>
                      {{ 'Kelola Profil' if current_lang == 'id' else 'Manage
                      Profile' }}
                    </button>
                  </div>
                </div>
              </div>
              <hr class="mt-10" />

              <!-- Content 2 -->
              <div class="mt-10">
                <h1 class="text-2xl font-bold mb-8">
                  {{ 'Daftar Pengguna' if current_lang == 'id' else 'Users List'
                  }}
                </h1>
                <!-- Search Bar -->
                <div class="flex flex-wrap items-center gap-3 mb-14">
                  <input
                    type="text"
                    placeholder="Cari pengguna..."
                    class="px-4 py-2 border rounded-lg dark:bg-gray-800 dark:text-white"
                  />

                  <select
                    class="px-4 py-2 border rounded-lg dark:bg-gray-800 dark:text-white"
                  >
                    <option>
                      {{ 'Semua Role' if current_lang == 'id' else 'All Roles'
                      }}
                    </option>
                    <option>
                      {{ 'Peserta' if current_lang == 'id' else 'Participant' }}
                    </option>
                    <option>
                      {{ 'Penilai' if current_lang == 'id' else 'Evaluator' }}
                    </option>
                    <option>Admin</option>
                  </select>

                  <select
                    class="px-4 py-2 border rounded-lg dark:bg-gray-800 dark:text-white"
                  >
                    <option>Status</option>
                    <option>
                      {{ 'Aktif' if current_lang == 'id' else 'Active' }}
                    </option>
                    <option>
                      {{ 'Nonaktif' if current_lang == 'id' else 'Inactive' }}
                    </option>
                  </select>
                </div>

                <!-- Daftar Pengguna -->
                <div
                  class="overflow-x-auto mb-10 bg-white dark:bg-gray-900 shadow rounded-lg"
                >
                  <table class="w-full text-left border-collapse">
                    <thead>
                      <tr
                        class="bg-gray-300 dark:bg-gray-900 text-gray-700 dark:text-gray-300"
                      >
                        <th class="border p-2 px-4 py-2">No</th>
                        <th class="border p-2 px-4 py-2">
                          {{ 'Nama Lengkap' if current_lang == 'id' else 'Full
                          Name' }}
                        </th>
                        <th class="border p-2 px-4 py-2">Email</th>
                        <th class="border p-2 px-4 py-2">Username</th>
                        <th class="border p-2 px-4 py-2">Role</th>
                        <th class="border p-2 px-4 py-2">Status</th>
                        <th class="border p-2 px-4 py-2">
                          {{ 'Aksi' if current_lang == 'id' else 'Action' }}
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for user in users %}
                      <tr class="border-b dark:border-gray-700">
                        <td class="border p-2">{{ loop.index }}</td>
                        <td class="border p-2 px-4 py-2">
                          {{ user.nama_lengkap }}
                        </td>
                        <td class="border p-2 px-4 py-2">{{ user.email }}</td>
                        <td class="border p-2 px-4 py-2">
                          {{ user.username }}
                        </td>
                        <td class="border p-2 px-4 py-2">{{ user.role }}</td>
                        <td class="border p-2 px-4 py-2">
                          <span
                            class="px-2 py-1 text-xs rounded-lg {{ 'bg-green-100 text-green-600' if user.status == 'active' else 'bg-red-100 text-red-600' }}"
                          >
                            {{ user.status }}
                          </span>
                        </td>
                        <td class="border p-2 px-4 py-2 flex gap-2">
                          <button
                            class="px-3 py-1 rounded bg-blue-500 text-white text-xs cursor-pointer"
                          >
                            Edit
                          </button>
                          <button
                            class="px-3 py-1 rounded bg-red-500 text-white text-xs cursor-pointer"
                          >
                            {{ 'Hapus' if current_lang == 'id' else 'Edit' }}
                          </button>
                        </td>
                      </tr>
                      {% else %}
                      <tr>
                        <td
                          colspan="7"
                          class="p-4 text-center text-gray-500 mt-4"
                        >
                          {{ 'Tidak ada data' if current_lang == 'id' else 'No
                          data available' }}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <!-- Animation & Notification Script -->
    {% include 'script_animation.html' %} {% include 'script_notification.html'
    %}
  </body>
</html>
